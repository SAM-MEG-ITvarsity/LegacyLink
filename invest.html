<script>
document.addEventListener("DOMContentLoaded", () => {
  const steps = document.querySelectorAll(".step");
  const progressLine = document.querySelector(".progress-line");
  const fieldsets = document.querySelectorAll(".form-step");
  let currentStep = 0;

  function updateSteps() {
    steps.forEach((step, index) => {
      step.classList.toggle("active", index <= currentStep);
    });
    const activeSteps = (currentStep / (steps.length - 1)) * 100;
    progressLine.style.setProperty("--progress-width", ${activeSteps}%);
  }

  document.querySelectorAll(".next").forEach(btn => {
    btn.addEventListener("click", () => {
      if (currentStep < fieldsets.length - 1) {
        fieldsets[currentStep].classList.remove("active");
        currentStep++;
        fieldsets[currentStep].classList.add("active");
        updateSteps();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  });

  document.querySelectorAll(".prev").forEach(btn => {
    btn.addEventListener("click", () => {
      if (currentStep > 0) {
        fieldsets[currentStep].classList.remove("active");
        currentStep--;
        fieldsets[currentStep].classList.add("active");
        updateSteps();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  });

  updateSteps();

  // Overlay and elements
  const overlay = document.getElementById("paymentOverlay");
  const closeOverlay = document.getElementById("closeOverlay");
  const proceedBtn = document.getElementById("proceedPaymentBtn");
  const termsCheckbox = document.getElementById("acceptTerms");
  const form = document.getElementById("fullPaymentForm");
  const successMsg = document.getElementById("successMessage");
  const nextPaymentDate = document.getElementById("nextPaymentDate");

  proceedBtn.addEventListener("click", () => {
    if (termsCheckbox.checked) {
      overlay.style.display = "flex";
    } else {
      alert("Please accept the Terms and Conditions before proceeding.");
    }
  });

  closeOverlay.addEventListener("click", () => {
    overlay.style.display = "none";
  });

  window.addEventListener("click", (event) => {
    if (event.target === overlay) {
      overlay.style.display = "none";
    }
  });

  const cardNumber = document.getElementById("cardNumber");
  const cardIcon = document.getElementById("cardIcon");
  cardNumber.addEventListener("input", () => {
    const val = cardNumber.value;
    if (/^4/.test(val)) cardIcon.className = "fa-brands fa-cc-visa";
    else if (/^5[1-5]/.test(val)) cardIcon.className = "fa-brands fa-cc-mastercard";
    else if (/^3[47]/.test(val)) cardIcon.className = "fa-brands fa-cc-amex";
    else cardIcon.className = "fa-solid fa-credit-card";
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    form.style.display = "none";
    successMsg.style.display = "block";

    const today = new Date();
    today.setDate(today.getDate() + 30);
    nextPaymentDate.textContent = today.toLocaleDateString("en-ZA");
  });

  function goBack() {
    window.history.back();
 Â }
});
</script>
